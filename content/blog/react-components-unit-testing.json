{"title":"Unit testing React components","headings":[{"level":2,"text":"Easy unit testing React components (without a DOM)","id":"easy-unit-testing-react-components-without-a-dom"},{"level":1,"text":"What about testing events like onClick?","id":"what-about-testing-events-like-onclick"}],"date":"2015-11-24T00:00:00.000Z","tags":["js","react","tests"],"body":{"tag":"div","children":[{"tag":"p","children":["The React team has implemented a feature called\n",{"tag":"a","props":{"href":"http://facebook.github.io/react/docs/test-utils.html#shallow-rendering"},"children":["shallow rendering"]},",\nwhich"]},"\n",{"tag":"blockquote","children":["\n",{"tag":"p","children":["lets you render a component \"one level deep\" and assert facts about what its\nrender method returns, without worrying about the behavior of child\ncomponents, which are not instantiated or rendered. This does not require a\nDOM."]},"\n"]},"\n",{"tag":"p","children":["Sounds good, right? And guess what, shallow rendering is currently the\n",{"tag":"a","props":{"href":"https://discuss.reactjs.org/t/whats-the-prefered-way-to-test-react-js-components/26"},"children":["preferred way to test your React components"]},"."]},"\n",{"tag":"p","children":["As you can see in the post mentioned at the end of this one, the actual code to\ntest some components might seem a bit longer that what you might expect."]},"\n",{"tag":"p","children":["Thankfully, ",{"tag":"a","props":{"href":"https://github.com/vvo"},"children":["someone"]}," created something pretty cool:\n",{"tag":"a","props":{"href":"https://github.com/algolia/react-element-to-jsx-string"},"children":["react-element-to-jsx-string"]},".\nAs the name of the package says, this library helps to render a react component\ninto a JSX string."]},"\n",{"tag":"p","children":["Now things start to become interesting: with those two things in mind (shallow\nrender and react components as JSX strings), we can easily add some basic unit\ntests for some components."]},"\n",{"tag":"p","children":[{"tag":"em","children":["There are others techniques to test React components, and most of those involve\nthe DOM. This means you will need to run your tests in the browser (or using\njsdom): your tests will be slower than the following method (which is more real\nunit testing since you execute less code and do not require a huge\nenvironment)."]}]},"\n",{"tag":"h2","props":{"id":"easy-unit-testing-react-components-without-a-dom"},"children":[{"tag":"a","props":{"aria-hidden":"true","href":"#easy-unit-testing-react-components-without-a-dom"},"children":[{"tag":"span","props":{"class":"icon icon-link"}}]},"Easy unit testing React components (without a DOM)"]},"\n",{"tag":"p","children":["Let's do this with the following (dumb) component:"]},"\n",{"tag":"pre","children":[{"tag":"code","props":{"class":"hljs language-js"},"children":[{"tag":"span","props":{"class":"hljs-comment"},"children":["// web_modules/Picture/index.js"]},"\n\n",{"tag":"span","props":{"class":"hljs-keyword"},"children":["import"]}," React ",{"tag":"span","props":{"class":"hljs-keyword"},"children":["from"]}," ",{"tag":"span","props":{"class":"hljs-string"},"children":["\"react\""]},";\n",{"tag":"span","props":{"class":"hljs-keyword"},"children":["import"]}," { PropTypes } ",{"tag":"span","props":{"class":"hljs-keyword"},"children":["from"]}," ",{"tag":"span","props":{"class":"hljs-string"},"children":["\"react\""]},";\n\n",{"tag":"span","props":{"class":"hljs-keyword"},"children":["const"]}," Component = ",{"tag":"span","props":{"class":"hljs-function"},"children":["(",{"tag":"span","props":{"class":"hljs-params"},"children":["{ img, title, Loader, Title }"]},") =>"]}," (\n  ",{"tag":"span","props":{"class":"xml"},"children":[{"tag":"span","props":{"class":"hljs-tag"},"children":["<",{"tag":"span","props":{"class":"hljs-name"},"children":["div"]},">"]},"\n    {(!img || !img.src) && Loader && ",{"tag":"span","props":{"class":"hljs-tag"},"children":["<",{"tag":"span","props":{"class":"hljs-name"},"children":["Loader"]}," />"]},"}\n    {img && img.src && ",{"tag":"span","props":{"class":"hljs-tag"},"children":["<",{"tag":"span","props":{"class":"hljs-name"},"children":["img"]}," ",{"tag":"span","props":{"class":"hljs-attr"},"children":["src"]},"=",{"tag":"span","props":{"class":"hljs-string"},"children":["{img.src}"]}," ",{"tag":"span","props":{"class":"hljs-attr"},"children":["alt"]},"=",{"tag":"span","props":{"class":"hljs-string"},"children":["{img.alt}"]}," />"]},"}\n    {title && Title && ",{"tag":"span","props":{"class":"hljs-tag"},"children":["<",{"tag":"span","props":{"class":"hljs-name"},"children":["Title"]}," ",{"tag":"span","props":{"class":"hljs-attr"},"children":["text"]},"=",{"tag":"span","props":{"class":"hljs-string"},"children":["{title}"]}," />"]},"}\n  ",{"tag":"span","props":{"class":"hljs-tag"},"children":["</",{"tag":"span","props":{"class":"hljs-name"},"children":["div"]},">"]}]},"\n);\n\nComponent.propTypes = {\n  ",{"tag":"span","props":{"class":"hljs-attr"},"children":["img"]},": PropTypes.object,\n  ",{"tag":"span","props":{"class":"hljs-attr"},"children":["title"]},": PropTypes.string,\n  ",{"tag":"span","props":{"class":"hljs-attr"},"children":["Loader"]},": PropTypes.func.isRequired,\n  ",{"tag":"span","props":{"class":"hljs-attr"},"children":["Title"]},": PropTypes.func.isRequired\n};\n\nComponent.displayName = ",{"tag":"span","props":{"class":"hljs-string"},"children":["\"Picture\""]},";\n\n",{"tag":"span","props":{"class":"hljs-keyword"},"children":["export"]}," ",{"tag":"span","props":{"class":"hljs-keyword"},"children":["default"]}," Component;"]}]},"\n",{"tag":"p","children":["This component displays an image with a title component. If the image data is\nnot ready yet, it can display a loader component."]},"\n",{"tag":"p","children":["Now let's write a simple test for it. For the example we will use\n",{"tag":"a","props":{"href":"https://medium.com/javascript-scene/why-i-use-tape-instead-of-mocha-so-should-you-6aa105d8eaf4"},"children":["tape"]},"\nwith the help of ",{"tag":"a","props":{"href":"https://github.com/atabel/tape-jsx-equals"},"children":["tape-jsx-equals"]},",\nbut you will find\n",{"tag":"a","props":{"href":"https://www.npmjs.com/search?q=expect+jsx"},"children":["all kind of flavors on npm"]},"."]},"\n",{"tag":"pre","children":[{"tag":"code","props":{"class":"hljs language-js"},"children":[{"tag":"span","props":{"class":"hljs-comment"},"children":["// web_modules/Picture/__tests__/index.js"]},"\n\n",{"tag":"span","props":{"class":"hljs-keyword"},"children":["import"]}," tape ",{"tag":"span","props":{"class":"hljs-keyword"},"children":["from"]}," ",{"tag":"span","props":{"class":"hljs-string"},"children":["\"tape\""]},";\n",{"tag":"span","props":{"class":"hljs-keyword"},"children":["import"]}," addAssertions ",{"tag":"span","props":{"class":"hljs-keyword"},"children":["from"]}," ",{"tag":"span","props":{"class":"hljs-string"},"children":["\"extend-tape\""]},";\n",{"tag":"span","props":{"class":"hljs-keyword"},"children":["import"]}," jsxEquals ",{"tag":"span","props":{"class":"hljs-keyword"},"children":["from"]}," ",{"tag":"span","props":{"class":"hljs-string"},"children":["\"tape-jsx-equals\""]},";\n",{"tag":"span","props":{"class":"hljs-keyword"},"children":["const"]}," test = addAssertions(tape, { jsxEquals });\n\n",{"tag":"span","props":{"class":"hljs-keyword"},"children":["import"]}," React ",{"tag":"span","props":{"class":"hljs-keyword"},"children":["from"]}," ",{"tag":"span","props":{"class":"hljs-string"},"children":["\"react\""]},";\n",{"tag":"span","props":{"class":"hljs-keyword"},"children":["import"]}," { createRenderer } ",{"tag":"span","props":{"class":"hljs-keyword"},"children":["from"]}," ",{"tag":"span","props":{"class":"hljs-string"},"children":["\"react-addons-test-utils\""]},";\n\n",{"tag":"span","props":{"class":"hljs-keyword"},"children":["import"]}," Picture ",{"tag":"span","props":{"class":"hljs-keyword"},"children":["from"]}," ",{"tag":"span","props":{"class":"hljs-string"},"children":["\"..\""]},";\n\n",{"tag":"span","props":{"class":"hljs-comment"},"children":["// fixtures (empty and stateless react components)"]},"\n",{"tag":"span","props":{"class":"hljs-keyword"},"children":["const"]}," Loader = ",{"tag":"span","props":{"class":"hljs-function"},"children":["() =>"]}," {};\n",{"tag":"span","props":{"class":"hljs-keyword"},"children":["const"]}," Title = ",{"tag":"span","props":{"class":"hljs-function"},"children":["() =>"]}," {};\n\ntest(",{"tag":"span","props":{"class":"hljs-string"},"children":["\"PageContainer is properly rendered\""]},", ",{"tag":"span","props":{"class":"hljs-function"},"children":[{"tag":"span","props":{"class":"hljs-params"},"children":["t"]}," =>"]}," {\n  ",{"tag":"span","props":{"class":"hljs-keyword"},"children":["const"]}," renderer = createRenderer();\n\n  renderer.render(",{"tag":"span","props":{"class":"xml"},"children":[{"tag":"span","props":{"class":"hljs-tag"},"children":["<",{"tag":"span","props":{"class":"hljs-name"},"children":["Picture"]}," ",{"tag":"span","props":{"class":"hljs-attr"},"children":["Loader"]},"=",{"tag":"span","props":{"class":"hljs-string"},"children":["{Loader}"]}," ",{"tag":"span","props":{"class":"hljs-attr"},"children":["Title"]},"=",{"tag":"span","props":{"class":"hljs-string"},"children":["{Title}"]}," />"]}]},");\n  t.jsxEquals(\n    renderer.getRenderOutput(),\n    ",{"tag":"span","props":{"class":"xml"},"children":[{"tag":"span","props":{"class":"hljs-tag"},"children":["<",{"tag":"span","props":{"class":"hljs-name"},"children":["div"]},">"]},"\n      ",{"tag":"span","props":{"class":"hljs-tag"},"children":["<",{"tag":"span","props":{"class":"hljs-name"},"children":["Loader"]}," />"]},"\n    ",{"tag":"span","props":{"class":"hljs-tag"},"children":["</",{"tag":"span","props":{"class":"hljs-name"},"children":["div"]},">"]}]},",\n    ",{"tag":"span","props":{"class":"hljs-string"},"children":["\"can render a Loader component if no image data are passed\""]},"\n  );\n\n  renderer.render(\n    ",{"tag":"span","props":{"class":"xml"},"children":[{"tag":"span","props":{"class":"hljs-tag"},"children":["<",{"tag":"span","props":{"class":"hljs-name"},"children":["Picture"]},"\n      ",{"tag":"span","props":{"class":"hljs-attr"},"children":["Loader"]},"=",{"tag":"span","props":{"class":"hljs-string"},"children":["{Loader}"]},"\n      ",{"tag":"span","props":{"class":"hljs-attr"},"children":["Title"]},"=",{"tag":"span","props":{"class":"hljs-string"},"children":["{Title}"]},"\n      ",{"tag":"span","props":{"class":"hljs-attr"},"children":["img"]},"=",{"tag":"span","props":{"class":"hljs-string"},"children":["{{"]},"\n        ",{"tag":"span","props":{"class":"hljs-attr"},"children":["src:"]}," \"",{"tag":"span","props":{"class":"hljs-attr"},"children":["SRC"]},"\",\n        ",{"tag":"span","props":{"class":"hljs-attr"},"children":["alt:"]}," \"",{"tag":"span","props":{"class":"hljs-attr"},"children":["ALT"]},"\"\n      }}\n    />"]}]},"\n  );\n  t.jsxEquals(\n    renderer.getRenderOutput(),\n    ",{"tag":"span","props":{"class":"xml"},"children":[{"tag":"span","props":{"class":"hljs-tag"},"children":["<",{"tag":"span","props":{"class":"hljs-name"},"children":["div"]},">"]},"\n      ",{"tag":"span","props":{"class":"hljs-tag"},"children":["<",{"tag":"span","props":{"class":"hljs-name"},"children":["img"]}," ",{"tag":"span","props":{"class":"hljs-attr"},"children":["src"]},"=",{"tag":"span","props":{"class":"hljs-string"},"children":["\"SRC\""]}," ",{"tag":"span","props":{"class":"hljs-attr"},"children":["alt"]},"=",{"tag":"span","props":{"class":"hljs-string"},"children":["\"ALT\""]}," />"]},"\n    ",{"tag":"span","props":{"class":"hljs-tag"},"children":["</",{"tag":"span","props":{"class":"hljs-name"},"children":["div"]},">"]}]},",\n    ",{"tag":"span","props":{"class":"hljs-string"},"children":["\"should render an image if data are passed\""]},"\n  );\n\n  renderer.render(\n    ",{"tag":"span","props":{"class":"xml"},"children":[{"tag":"span","props":{"class":"hljs-tag"},"children":["<",{"tag":"span","props":{"class":"hljs-name"},"children":["Picture"]},"\n      ",{"tag":"span","props":{"class":"hljs-attr"},"children":["Loader"]},"=",{"tag":"span","props":{"class":"hljs-string"},"children":["{Loader}"]},"\n      ",{"tag":"span","props":{"class":"hljs-attr"},"children":["Title"]},"=",{"tag":"span","props":{"class":"hljs-string"},"children":["{Title}"]},"\n      ",{"tag":"span","props":{"class":"hljs-attr"},"children":["img"]},"=",{"tag":"span","props":{"class":"hljs-string"},"children":["{{"]},"\n        ",{"tag":"span","props":{"class":"hljs-attr"},"children":["src:"]}," \"",{"tag":"span","props":{"class":"hljs-attr"},"children":["SRC"]},"\",\n        ",{"tag":"span","props":{"class":"hljs-attr"},"children":["alt:"]}," \"",{"tag":"span","props":{"class":"hljs-attr"},"children":["ALT"]},"\"\n      }}\n      ",{"tag":"span","props":{"class":"hljs-attr"},"children":["title"]},"=",{"tag":"span","props":{"class":"hljs-string"},"children":["{"]},"\"",{"tag":"span","props":{"class":"hljs-attr"},"children":["TITLE"]},"\"}\n    />"]}]},"\n  );\n  t.jsxEquals(\n    renderer.getRenderOutput(),\n    ",{"tag":"span","props":{"class":"xml"},"children":[{"tag":"span","props":{"class":"hljs-tag"},"children":["<",{"tag":"span","props":{"class":"hljs-name"},"children":["div"]},">"]},"\n      ",{"tag":"span","props":{"class":"hljs-tag"},"children":["<",{"tag":"span","props":{"class":"hljs-name"},"children":["img"]}," ",{"tag":"span","props":{"class":"hljs-attr"},"children":["src"]},"=",{"tag":"span","props":{"class":"hljs-string"},"children":["\"SRC\""]}," ",{"tag":"span","props":{"class":"hljs-attr"},"children":["alt"]},"=",{"tag":"span","props":{"class":"hljs-string"},"children":["\"ALT\""]}," />"]},"\n      ",{"tag":"span","props":{"class":"hljs-tag"},"children":["<",{"tag":"span","props":{"class":"hljs-name"},"children":["Title"]}," ",{"tag":"span","props":{"class":"hljs-attr"},"children":["text"]},"=",{"tag":"span","props":{"class":"hljs-string"},"children":["\"TITLE\""]}," />"]},"\n    ",{"tag":"span","props":{"class":"hljs-tag"},"children":["</",{"tag":"span","props":{"class":"hljs-name"},"children":["div"]},">"]}]},",\n    ",{"tag":"span","props":{"class":"hljs-string"},"children":["\"can render a Title if data are passed\""]},"\n  );\n\n  t.end();\n});"]}]},"\n",{"tag":"p","children":["These tests are the minimum coverage to ensure you don't break anything when you\nwork on your component."]},"\n",{"tag":"p","children":["As you can see, the tests here are pretty easy to write & straightforward.\\\n",{"tag":"strong","children":["The interesting part is that you don't compare using strings. You can use real\nReact components."]}]},"\n",{"tag":"p","children":["You can easily run this full example by getting it from this repository:"]},"\n",{"tag":"p","children":[{"tag":"a","props":{"href":"https://github.com/MoOx/react-component-unit-testing-example"},"children":["github.com/MoOx/react-component-unit-testing-example"]}]},"\n",{"tag":"p","children":["This example contains all the commands and dependencies (defined in the\n",{"tag":"code","children":["package.json"]},") that you might need."]},"\n",{"tag":"h1","props":{"id":"what-about-testing-events-like-onclick"},"children":[{"tag":"a","props":{"aria-hidden":"true","href":"#what-about-testing-events-like-onclick"},"children":[{"tag":"span","props":{"class":"icon icon-link"}}]},"What about testing events like ",{"tag":"code","children":["onClick"]},"?"]},"\n",{"tag":"p","children":["You don't need to reproduce the entire click."]},"\n",{"tag":"p","children":[{"tag":"strong","children":["Your tests don't need to check that your ",{"tag":"code","children":["onClick"]}," prop will be executed when\nyou click on a DOM element."]}," ",{"tag":"em","children":["React probably have tests to cover this."]}]},"\n",{"tag":"p","children":["You only need to test that the ",{"tag":"code","children":["onClick"]}," prop value will do what you want. So if\nyou have something like ",{"tag":"code","children":["onClick={ yourCallback }"]},", just call directly\n",{"tag":"code","children":["yourCallback()"]}," in your test just before your comparison. That's enough!"]},"\n",{"tag":"p","children":["If you want to go deeper, you might also read:"]},"\n",{"tag":"ul","children":["\n",{"tag":"li","children":[{"tag":"a","props":{"href":"http://simonsmith.io/unit-testing-react-components-without-a-dom/"},"children":[{"tag":"em","children":["Unit testing React components without a DOM"]}]},",\nby Simon Smith, that covers the same topic without the simplicity of the JSX\ncomparisons,"]},"\n",{"tag":"li","children":[{"tag":"a","props":{"href":"https://blog.algolia.com/how-we-unit-test-react-components-using-expect-jsx/"},"children":[{"tag":"em","children":["How we unit test React components using expect-jsx"]}]},"\non Algolia blog, that explains why they choose and create tools for this\napproach."]},"\n"]},"\n",{"tag":"p","children":["With all those examples, we hope you will stop being afraid to test your code\nand will not hesitate to cover all your React components with tests 😍."]}]}}